repos:
  - repo: https://github.com/streetsidesoftware/cspell-cli
    rev: v8.17.3
    hooks:
      # TODO: remove next two steps.
      # 1. Make our clone of https://github.com/streetsidesoftware/cspell-cli
      # 2. Add dependencies to `package.json`
      - id: cspell
        name: Install dicts
        entry: npm install -g @cspell/dict-ru_ru
        args: []
        pass_filenames: false
        always_run: true
      - id: cspell
        name: Add dicts
        args:
          - link
          - add
          - "@cspell/dict-ru_ru"
        pass_filenames: false
        always_run: true
      - id: cspell # Spell check changed files
      - id: cspell # Spell check the commit message
        name: check commit message spelling
        args:
          - --no-must-find-files
          - --no-progress
          - --no-summary
          - --files
          - .git/COMMIT_EDITMSG
        stages: [commit-msg]
        always_run: true # This might not be necessary.
  - repo: local
    hooks:
      - id: go-mod-tidy
        name: Run `go mod tidy` fo all the modules
        language: golang
        entry: ./hack/for-each-mod go mod tidy
        pass_filenames: false
        types:
          - file
        files: ^.*/go\.mod$
      - id: test-ce
        name: Run `go test -tags=ee ./...` for all the modules
        pass_filenames: false
        language: golang
        entry: ./hack/for-each-mod go test -tags=ce ./...
        types: [go]
      - id: test-ee
        name: Run `go test -tags=ce ./...` for all the modules
        pass_filenames: false
        language: golang
        entry: ./hack/for-each-mod go test -tags=ce ./...
        types: [go]
  - repo: https://github.com/golangci/golangci-lint
    rev: v1.64.5
    hooks:
      - id: golangci-lint
        name: Run golangci-lint with tag `ee`
        entry: ./hack/for-each-mod golangci-lint run --new-from-rev HEAD --build-tags ee --fix
      - id: golangci-lint
        name: Run golangci-lint with tag `ce`
        entry: ./hack/for-each-mod golangci-lint run --new-from-rev HEAD --build-tags ce --fix
