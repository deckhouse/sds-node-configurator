---
title: "The SDS-Node-Configurator module: usage examples"
description: Usage and examples of the SDS-Node-Configurator controller operation.
---

{% alert level="warning" %}
The module is guaranteed to work in the following cases only:
- if stock kernels shipped with [supported distributions](../../supported_versions.html#linux) are used;
- if a 10Gbps network is used.

As for any other configurations, the module may work, but its smooth operation is not guaranteed.
{% endalert %}

The controller supports two types of resources:
* `BlockDevice`;
* `LVMVolumeGroup`.

## [BlockDevice](block device) resources

### Creating a `BlockDevice` resource

Контроллер регулярно сканирует существующие девайсы на узле, и в случае, если девайс удовлетворяет всем необходимым
условиям со стороны контроллера, создается `custom resource` (CR) `BlockDevice` с уникальным именем, в котором отображена
полная и необходимая информация о соответствующем девайсе.

#### Требования контроллера к девайсу

* Не является drbd-устройством.
* Не является псевдодевайсом (то есть не loop device).
* Не является `Logical Volume`.
* Файловая система отсутствует или соответствует LVM2_MEMBER.
* У блок-девайса отсутствуют партиции.
* Размер блок-девайса больше 1 Gi.
* Если девайс — виртуальный диск, у него должен быть серийный номер.

Информацию из полученного ресурса контроллер будет использовать для своей дальнейшей работы с ресурсами `LVMVolumeGroup`.

### Обновление `BlockDevice`-ресурса

Контроллер самостоятельно обновляет информацию в ресурсе, если состояние указанного в нем блок-девайса поменялось.

### Удаление `BlockDevice`-ресурса

Контроллер автоматически удалит ресурс, если указанный в нем блок-девайс стал недоступен в следующих случаях:
* если ресурс был в статусе Consumable;
* если блок-девайс принадлежит `Volume Group`, у которой нет тега `storage.deckhouse.io/enabled=true` (эта `Volume Group` не управляется нашим контроллером).

> Контроллер выполняет вышеперечисленные виды работ автоматически и не требует вмешательства со стороны пользователя.

## [LVMVolumeGroup](lvmVolumeGroup) resources

Ресурсы `BlockDevice` необходимы для создания и обновления ресурсов `LVMVolumeGroup`.

`LVMVolumeGroup`-ресурсы предназначены для взаимодействия с `Volume Group` и отображения актуальной информации об их состоянии.

### Создание `LVMVolumeGroup`-ресурса и `Volume Group`

Ресурс `LVMVolumeGroup` может быть создан 2 способами:
* Автоматическое создание:
  * Контроллер автоматически сканирует информацию о существующих `Volume Group` на узлах и создает ресурс в случае,
  если у `Volume Group` имеется тег `storage.deckhouse.io/enabled=true` и соответствующий ресурс по ней отсутствует.
  * В этом случае контроллер самостоятельно заполняет все поля ресурса.
* Пользовательское создание:
  * Пользователь вручную создает ресурс, заполняя только поле `Spec`, в котором указывает желаемое состояние новой `Volume Group`.
  * Информация, указанная пользователем, пройдет специальную валидацию на корректность предоставленной конфигурации и возможности ее реализации.
  * После успешного прохождения валидации контроллер использует указанную информацию, чтобы по ней создать указанную `Volume Group` и обновить пользовательский ресурс актуальной информацией о состоянии созданной `Volume Group`.

### Обновление `LVMVolumeGroup`-ресурса и `Volume Group`

Контроллер в автоматическом режиме обновляет поле `Status` ресурса `LVMVolumeGroup`, отображая актуальные данные об указанной `Volume Group`.
Пользователю **не рекомендуется** собственноручно вносить изменения в поле `Status`.

> Контроллер не обновляет поле `Spec`, так как указанное поле отображает желаемое состояние `Volume Group`. Пользователь может вносить изменения в поле `Spec`, чтобы изменить состояние указанной в ресурсе `Volume Group`.

### Удаление `LVMVolumeGroup`-ресурса и `Volume Group`

Контроллер автоматически удалит ресурс, если указанная в нем `Volume Group` стала недоступна по той или иной причине.

> Пользователь может удалить ресурс самостоятельно, но в том случае, если на момент удаления ресурса соответствующая `Volume Group`
> еще будет существовать, контроллер создаст по существующей `Volume Group` ресурс *автоматически*, указав для созданного
> ресурса новое сгенерированное имя.

Пользователь может удалить `Volume Group` и связанные с ним `Physical Volume`, добавив в соответствующий `LVMVolumeGroup`-ресурс аннотацию `storage.deckhouse.io/sds-delete-vg: ""`.

Контроллер отреагирует на указанную аннотацию и запустит процесс удаления `Volume Group` и ее составляющих.

Результатом работы контроллера станет удаление `Volume Group`, связанных с ней `Physical Volume`, а также самого ресурса `LVMVolumeGroup` в случае, **если на `Volume Group` отсутствуют `Logical Volume`**. Если на `Volume Group` будет `Logical Volume`, пользователю предварительно необходимо самостоятельно удалить `Logical Volume` на узле.
