---
title: "Модуль SDS-Node-Configurator: примеры использования"
description: Использование и примеры работы SDS-Node-Configurator контроллера.
---

Работу контроллера можно разделить на 2 типа:
1. ### Работа с ресурсами [BlockDevice](block device).
#### Создание `BlockDevice` ресурса.
Контроллер регулярно сканирует существующие девайсы на ноде, и в случае, если девайс удовлетворяет всем необходимым 
условиям со стороны контроллера, то создается `Custom resource` (CR) `BlockDevice` с уникальным именем, в котором отображена
полная и необходимая информация о соответствующем девайсе.

Требования контроллера к девайсу:
* не является drbd-устройством
* не является псевдо-девайсом (т.е. не loop device)
* не является `Logical Volume`
* файловая система отсутствует или соответствует LVM2_MEMBER
* у девайса отсутствуют партиции 
* размер девайса больше 1 Gi

Информацию из полученного ресурса контроллер будет использовать для своей дальнейшей работы.
###
#### Обновление `BlockDevice` ресурса.
Контроллер самостоятельно обновляет информацию в ресурсе, если состояние указанного в нем девайса поменялось.
###
#### Удаление `BlockDevice` ресурса.
Контроллер автоматически удалит ресурс, если указанный в нем девайс стал не доступен по той или иной причине.

> Контроллер выполняет вышеперечисленные виды работ автоматически и не требует вмешательства со стороны пользователя.
2. ### Работа с ресурсами [LVMVolumeGroup](lvmVolumeGroup).
Ресурсы `BlockDevice` необходимы для создания и обновления ресурсов `LVMVolumeGroup`.

`LVMVolumeGroup` ресурсы предназначены для взаимодействия с `Volume Group` и отображения актуальной информации об их состоянии.

###
#### Создание `LVMVolumeGroup` ресурса и `Volume Group`.
Ресурс `LVMVolumeGroup` может быть создан 2 способами: 
* Автоматическое создание
  * Контроллер автоматически сканирует информацию о существующих `Volume Group` на нодах и создает ресурс в случае,
  если у `Volume Group` имеется тэг `storage.deckhouse.io/enabled=true` и соответствующей ресурс по ней отсутствует. 
  * В этом случае контроллер самостоятельно заполняет все поля ресурса.
* Пользовательское создание
  * Пользователь вручную создает ресурс, заполняя только поле `Spec`, в котором указывает желаемое состояние новой `Volume Group`. 
  * Информация, указанная пользователем, пройдет специальную валидацию на корректность предоставленной конфигурации
  и возможности ее реализации.
  * После успешного прохождения валидации контроллер использует указанную информацию, чтобы по ней создать указанную `Volume Group` и обновить пользовательский ресурс
  актуальной информацией о состоянии созданной `Volume Group`.

###
#### Обновление `LVMVolumeGroup` ресурса и `Volume Group`.
Контроллер в автоматическом режиме обновляет поле `Status` ресурса `LVMVolumeGroup`, отображая актуальные данные об указанной `Volume Group`.
Пользователю **не рекомендуется** собственноручно вносить изменения в поле `Status`.

> Контроллер не обновляет поле `Spec`, так как указанное поле отображает желаемое состояние `Volume Group`. Пользователь 
> может вносить изменения в поле `Spec`, чтобы изменить состояние указанной в ресурсе `Volume Group`.

###
#### Удаление `LVMVolumeGroup` ресурса и `Volume Group`.
Контроллер автоматически удалит ресурс, если указанная в нем `Volume Group` стала не доступна по той или иной причине.

> Пользователь может удалить ресурс самостоятельно, но в случае, если на момент удаления ресурса соответствующая `Volume Group`
> еще будет существовать, то контроллер создаст по существующей `Volume Group` ресурс *автоматически*, указав для созданного 
> ресурса новое сгенерированное имя.

Пользователь может удалить `Volume Group` и связанные с ним `Physical Volume`, добавив в соответствующий `LVMVolumeGroup` ресурс аннотацию
`storage.deckhouse.io/sds-delete-vg: ""`.

Контроллер отреагирует на указанную аннотацию и запустит процесс удаления `Volume Group` и ее составляющих.

Результатом работы контроллера станет удаление `Volume Group`, связанных с ней `Physical Volume`, а так же самого ресурса `LVMVolumeGroup`, 
в случае **если на `Volume Group` отсутствуют `Logical Volume`**.



